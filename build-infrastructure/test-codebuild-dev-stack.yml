AWSTemplateFormatVersion: 2010-09-09
Description: A template that brings up a simple code pipeline for testing

Parameters:
    GithubFullRepoName:
      Type: String
      Description: The name of the repository that we want to use (e.g. aws/amazon-ecs-agent)
    GithubBranchName:
      Type: String
      Description: The name of the branch to use to build (e.g. mainline, dev)
    GithubRepositoryName:
      Type: String
      Description: The name of the repository
    CodeStarConnectionArn:
      Type: String
      Description: The ARN of the connection to use to connect to GitHub

Resources:
  CodeBuildTest:
    Type: 'AWS::CodeBuild::Project'
    Properties:
      Name: !Ref 'AWS::StackName'
      ServiceRole: !GetAtt CodeBuildServiceRole.Arn
      Source:
        Type: GITHUB
        Location: !Sub 'https://github.com/mye956/${GithubRepositoryName}.git'
        BuildSpec: buildspecs/test-buildspec.yml
        Auth:
          Type: OAUTH
          Resource: !Ref CodeBuildSourceCredential
      Artifacts:
        Type: NO_ARTIFACTS
      Triggers:
        Webhook: true
        FilterGroups:
          - - Type: EVENT
              Pattern: 'PULL_REQUEST_CREATED, PULL_REQUEST_UPDATED'
            - Type: BASE_REF
              Pattern: !Sub ^refs/heads/${GithubBranchName}$